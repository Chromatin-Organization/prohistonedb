{% extends 'layouts/base.html.j2' %}

{% macro category_path(id) %}{{"contents/" + (categories[id|int].name | lower) + ".html"}}{% endmacro %}

{% block title %} {{siteName}} | Categories{% endblock title %}

{% block phyd3 %}
    <script src="{{ url_for('static', filename = 'assets/js/custom/jquery-3.7.0.min.js' )}}" type="text/javascript"></script>
    <script src="{{ url_for('static', filename = 'assets/js/custom/bootstrap.min.js' )}}" type="text/javascript"></script>
    <script src="{{ url_for('static', filename = 'assets/js/custom/d3.v3.min.js' )}}" type="text/javascript"></script>
    <script src="{{ url_for('static', filename = 'assets/js/custom/phyd3.min.js' )}}" type="text/javascript"></script>
    <link href="{{ url_for('static', filename = 'assets/css/phyd3.css' )}}" rel="stylesheet">
    {# <link href="{{ url_for('static', filename = 'assets/css/bootstrap.min.css' )}}" rel="stylesheet"> #}
{% endblock phyd3 %}

{% block skylign %}
    {# <script src="{{ url_for('static', filename = 'assets/js/custom/jquery-3.7.0.min.js' )}}" type="text/javascript"></script> #}
    <script src="{{ url_for('static', filename = 'assets/js/custom/scroller.js' )}}" type="text/javascript"></script>
    <script src="{{ url_for('static', filename = 'assets/js/custom/hmm_logo.bundle.js' )}}" type="text/javascript"></script>
    <link href="{{ url_for('static', filename = 'assets/css/hmm_logo.min.css' )}}" rel="stylesheet">
{% endblock skylign %}

{% block body %} class="categories fluid-bg" {% endblock body %}

{% block header %}

{% include 'includes/navigation_search.html.j2' %}

{% endblock header %}

{% block content %}

  <header>
    <div class="page-header pb-5">
      <div class="container">

        <div class="container mt-7">
          <div class="row">
            <div class="col-12">
              <h2 class="text-white pt-3">Histone categories</h2>
            </div>
          </div>
        </div>
      </div>

    </div>
  </header>
  
 <div class="card card-body mx-3 mx-md-4">
    <section class="my-3">
      <div class="container my-3">
        <div class="row">
          <div class="col-lg-3"></div>
          <div class="col-lg-9">
            <div class="row">
              <div class="category-links-block">
              <a href="{{url_for('categories.overview')}}" class="btn btn-sm btn-secondary w-auto me-1">Categories overview</a>
              {% for cat in categories.values() %}
                {% if cat.has_page %}
                  
                  {% if id is defined and cat.short_name == categories[id|int].short_name %} 
                    {% set btn_class = "btn-primary" %} 
                  {% else %} 
                    {% set btn_class = "btn-light" %} 
                  {% endif %}
                  
                  <a href="{{url_for('categories.with_id', id=cat.id)}}" class="btn btn-sm {{btn_class}} w-auto me-1" title="{{cat.name}}">
                    {{cat.short_name}}
                  </a>
                {% endif %}
              {% endfor %}
              </div>
            </div>

            <div class="row">
                {% if id is defined %}
                  {% include category_path(id) %}
                {% else %}
                  {% include "contents/categories overview.html" %}
                  <h3>2d cluster representation of ProHistone database</h3>
                  <div class="col-md-12 text-center">
                    <img src="{{url_for('static', filename = 'assets/img/2d_clusters.png')}}" class="col-md-9">
                  </div>
                {% endif %}
              </div>
          </div>
        </div>

        {# * PhyD3 phylogenetic tree viewer #}
        {% if id is defined %}
          {% if categories[id|int].name != 'Viral quadruplet' and categories[id|int].name != 'Viral triplet' %}
          <div class="row my-5">
              <div class="col-lg-3">
                {% include "contents/phylotree_legend.html" %}
              </div>
              <div class="col-lg-9">
                  <div class="row mt-3">
                      <div class="w-100">
                          <div id="phyd3-container" class="phy mx-auto w-100">
                              <div class="phyd3-overlay"><a href="/categories/viewer/{{ id }}" target="_blank"><h3>Click to open interactive version in new tab</h3></a></div>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
          {% endif %}
        {% endif %}

        {# * Skylign sequence alignment viewer #}
        {% if id is defined %}
          <div class="row my-5">
            <div class="col-lg-3">
                {% include "contents/hmm_legend.html" %}
            </div>
            <div class="col-lg-9">
                <div class="row mt-3">
                    <div class="w-100">
                        <div id="logo-container" class="logo mx-auto w-100" data-logo=""></div>
                        <div id="logo_info"></div>
                    </div>
                </div>
            </div>
          </div>
        {% endif %}
      </div>
    </section>
  </div>
  {% endblock content %}

  {% block javascripts %}
    {% if id is defined %}
      <script>
          const HMMJSONurl = '{{url_for('static', filename=(categories[id|int].static_logo_path | string))}}';
      </script>
      <script src="{{ url_for('static', filename = 'assets/js/custom/skylign.js' )}}" type="text/javascript"></script>
      {% if categories[id|int].name != 'Viral quadruplet' and categories[id|int].name != 'Viral triplet' %}
          <script>
              const phyd3xml = "{{ url_for('static', filename=(categories[id|int].static_phylotree_path | string)) }}";
          </script>
          <script src="{{ url_for('static', filename = 'assets/js/custom/phy.js') }}" type="text/javascript"></script>
      {% endif %}
    {% endif %}
  {% endblock javascripts %}