{% extends 'layouts/base.html.j2' %}

{% block title %} {{siteName}} Search {% endblock title %}
{% block body %} class="search bg-gray-200" {% endblock body %}

{% block header %}

{% include 'includes/navigation_search.html.j2' %}

{% endblock header %}

{% block content %}

  <header>
    <div class="page-header header-plain">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 my-auto">
            <h2 class="text-white">Search results for {{ request.args.get('q') }}</h2>
            <p class="mb-4 text-white">Showing 1-n of m results</p>
            
          </div>
        </div>
      </div>
    </div>
  </header>

  <div class="card card-body mx-3 mx-md-4 mt-n6">
     <div class="container my-3">
            <div class="row">
                <!-- sidebar left (search facets) -->
                <div id="facets-container" class="col-lg-3 col-md-4 d-none d-md-block mt-3">
                    <h3>Filter by:</h3>

                    <div class="row mt-3 filter-category">
                        <div class="label"><h5>Category</h5></div>
                        <div id="filter-category-container" class="col-10 ps-0 mb-2">
                            <div class="form-check">
                                {# TODO: build options from category table #}
                                {% for cat in categories %}
                                <div class="form-check ps-0">
                                    <input class="form-check-input" type="checkbox" value="{{cat}}" id="categoryCheck1">
                                    <label class="form-check-label" for="categoryCheck1">
                                        {{cat}}
                                    </label>
                                    <span class="filter-num badge">
                                        n
                                    </span>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>

                    <div class="row mt-3 filter-lineage">
                        <div class="label"><h5>Lineage</h5></div>
                        <div class="form-check col-10">
                            <input class="form-check-input" type="checkbox" value="" id="lineageCheck1">
                            <label class="form-check-label" for="lineageCheck1">
                                Archaea
                            </label>
                            <span class="filter-num badge">
                                n
                            </span>
                        </div>
                        <div class="form-check col-10">
                            <input class="form-check-input" type="checkbox" value="" id="lineageCheck2">
                            <label class="form-check-label" for="lineageCheck2">
                                Bacteria
                            </label>
                            <span class="filter-num badge">
                                n
                            </span>
                        </div>
                    </div>

                    <div class="row mt-3 filter-sequence">
                        <div class="label"><h5>Sequence length</h5></div>
                        <div class="form-check col-10">
                            <input class="form-check-input" type="checkbox" value="1" id="sequenceCheck1">
                            <label class="form-check-label" for="sequenceCheck1">
                                1 - 200
                            </label>
                            <span class="filter-num badge">
                                n
                            </span>
                        </div>
                        <div class="form-check col-10">
                            <input class="form-check-input" type="checkbox" value="201" id="sequenceCheck2">
                            <label class="form-check-label" for="sequenceCheck2">
                                201 - 400
                            </label>
                            <span class="filter-num badge">
                                n
                            </span>
                        </div>
                        <div class="form-check col-10">
                            <input class="form-check-input" type="checkbox" value="401" id="sequenceCheck3">
                            <label class="form-check-label" for="sequenceCheck3">
                                401 - 600
                            </label>
                            <span class="filter-num badge">
                                n
                            </span>
                        </div>
                        <div class="form-check col-10">
                            <input class="form-check-input" type="checkbox" value="601" id="sequenceCheck4">
                            <label class="form-check-label" for="sequenceCheck4">
                                601 - 800
                            </label>
                            <span class="filter-num badge">
                                n
                            </span>
                        </div>
                        <div class="form-check col-10">
                            <input class="form-check-input" type="checkbox" value="801" id="sequenceCheck5">
                            <label class="form-check-label" for="sequenceCheck5">
                                801 -
                            </label>
                            <span class="filter-num badge">
                                n
                            </span>
                        </div>
                    </div>
                </div>

                 <div class="col-lg-9 col-md-8">
                    
                    {# * dummy applied filters block #}
                    <div class="d-grid gap-2 d-md-block">
                        <span class="label">Filters:</span>
                        <button type="button" class="btn btn-light" style="vertical-align: baseline">UniProt accession
                            <i class="fa fa-close"></i>
                        </button>
                        <button type="button" class="btn btn-light" style="vertical-align: baseline">Nucleosomal
                            <i class="fa fa-close"></i>
                        </button>
                    </div>

                    {# card view #}
                    {# single entry; loop this section #}
                    {% for r in results %}
                    <div class="row mt-3 mb-5 result-item">
                        <h4><a href="{{ url_for('main.entry', uniprotID=r['uniprot_id']) }}">{{r["organism"]}} {{r["uniprot_id"]}}</a></h4>
                        <div class="row">
                            <div class="col-sm-3 label"><span>Protein</span></div>
                            <div class="col-sm-9 value">
                                <span class="mb-0">{{r["protein_id"]}}</span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-3 label"><span>Gene</span></div>
                            <div class="col-sm-9 value">
                                <span class="mb-0">{{r["gen_id"]}}</span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-3 label"><span>Source organism</span></div>
                            <div class="col-sm-9 value">
                                <span class="mb-0 float-start me-2">{{r["organism"]}}</span><span class="link"><a href="{{ url_for('search.index', org=r['organism']) }}">Search this organism</a></span>
                            </div>
                        </div>
                    </div>
                    {# ? show lineage in result? #}
                    {% endfor %}

                    {# table view #}
                    {# * https://getbootstrap.com/docs/5.0/content/tables/ #}
                    <table id="bs-table" class="table table-striped table-hover table-responsive-md" data-toggle="table">
                        <thead>
                            <tr>
                            <th data-field="uniprotID" scope="col">UniProt ID</th>
                            <th data-field="organism" scope="col">Protein</th>
                            <th data-field="gene" scope="col">Gene ID</th>
                            <th data-field="organism" scope="col">Organism</th>
                            <th data-field="sequence" scope="col">Length</th>
                            </tr>
                        </thead>
                        <tbody>
                        {% for r in results %}
                        <tr>
                            <td>{{r["uniprot_id"]}}</td>
                            <td>{{r["protein_id"]}}</td>
                            <td>{{r["gen_id"]}}</td>
                            <td>{{r["organism"]}}</td>
                            <td>{{r["sequence_len"]}} AA</td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            {# * dummy pager block #}
            {# show pager if result.num_pages > 1 #}
            <div class="row mt-5">
                <nav aria-label="Search results pages" class="mx-auto" style="width: auto">
                    <ul class="pagination">
                        {# check if current page num > 1, else hide prev page link #}
                        <li class="page-item"><a class="page-link prev" href="#"><<</a></li>
                        <li class="page-item active" aria-current="page"><a class="page-link" href="#">1</a></li>
                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                        <li class="page-item"><a class="page-link" href="#">3</a></li>
                        <li class="page-item"><a class="page-link next" href="#">>></a></li>
                    </ul>
                </nav>
            </div>

    </div>
  </div>
  {% endblock content %}

  {% block javascripts %}
    {# * not yet sure if we're going to need Bootstrap Table (https://bootstrap-table.com/)
    <script src="https://unpkg.com/bootstrap-table@1.21.4/dist/locale/bootstrap-table-en-US.min.js"></script>
    <link href="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.css" rel="stylesheet">
    <script src="https://unpkg.com/browse/bootstrap-table@1.21.4/dist/extensions/sticky-header/bootstrap-table-sticky-header.min.js"></script>
    <link href="https://unpkg.com/browse/bootstrap-table@1.21.4/dist/extensions/sticky-header/bootstrap-table-sticky-header.min.css" rel="stylesheet">
    #}

    <script>
        // change placeholder text to reflect we're searching within search results on the search results page
        window.addEventListener("DOMContentLoaded", e => {
            document.querySelector('input[name="q"]').placeholder = "Search within results";
        });
    </script>

  {% endblock javascripts %}